<!DOCTYPE html>
<!--[if lt IE 7 ]> <html lang="zh-CN" class="ie6 ielt8"> <![endif]-->
<!--[if IE 7 ]>    <html lang="zh-CN" class="ie7 ielt8"> <![endif]-->
<!--[if IE 8 ]>    <html lang="zh-CN" class="ie8"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html lang="zh-CN"><!--<![endif]-->
<head>
    <meta charset="UTF-8">
    <title>会员中心-用户注册</title>
    <!-- 别忘记此处的meta标签，确保IE都是在标准模式下渲染 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" >
    <link rel="stylesheet" href="{IMG_URL}templates/{TEMPLATE}/css/cmstop.common.css" />
    <link rel="stylesheet" href="{IMG_URL}templates/{TEMPLATE}/css/cmstop.basecolor.css" />
    <link rel="stylesheet" href="{IMG_URL}templates/{TEMPLATE}/css/cmstop.article.css" />
    <link rel="stylesheet" href="{IMG_URL}templates/{TEMPLATE}/css/cmstop.special.css" />
    <link rel="stylesheet" href="{IMG_URL}templates/{TEMPLATE}/css/cmstop.singup.css" />
    <link rel="stylesheet" href="{IMG_URL}templates/{TEMPLATE}/css/cmstop.dialog.css" />
    <link rel="stylesheet" href="{IMG_URL}templates/{TEMPLATE}/css/cmstop.datepicker.css" />
    <script type="text/javascript" src="{IMG_URL}js/config.js"></script>
    <script src="{IMG_URL}templates/{TEMPLATE}/js/jquery/jquery-1.11.2.js"></script>
    <script type="text/javascript" src="{IMG_URL}templates/{TEMPLATE}/js/jquery.cookie.js"></script>
    <script src="{IMG_URL}templates/{TEMPLATE}/js/cmstop.common.js"></script>
    <script src="{IMG_URL}templates/{TEMPLATE}/js/cmstop.dialog.js"></script>
    <script src="{IMG_URL}templates/{TEMPLATE}/js/cmstop.datepicker.js"></script>
    <script>
    $(function(){
        function setSingupHeigh() {
            var singupElement = $('.singup-box'),
            headerElement = $('.m-header'), 
            footerElement = $('.m-footer');
            if(singupElement.height() + headerElement.height() + footerElement.height() > $(document).height()) {
                singupElement.height($(document).height() - headerElement.height() - footerElement.height());
            }
        }
        setSingupHeigh();

    });
    </script>
    <!-- IE8及IE8以下浏览器都支持HTML5 -->
    <!--[if lt IE 9]>
        <script src="{IMG_URL}templates/{TEMPLATE}/js/html5/html5.js"></script>
    <![endif]-->
</head>
<body>
    <!-- 顶部 -->
    <!--{template "system/head_simple_php.html"}-->

    <!-- 用户注册 -->
    <div class="singup-box">
        <div class="hr100"></div>
        <div class="column singup-panel">
            <div class="inner">
                <div class="m-title-a">
                    <h2 class="m-title-h2"><a>用户注册</a></h2>
                </div>
                <div class="hr20"></div>
                <!-- 登录内容 -->
                <div class="singup-form ov">
                    <div class="singup-form-left singup-w580 fl-l">
                        <form action="{url('member/index/register')}" method="POST"  name="registerForm" id="member_registerForm">
                            <div class="hr20"></div>
                            <div class="ov">
                                <label class="label singup-w70 fl-l margin-r-20">用户名</label>
                                <div class="singup-line singup-item singup-w430 fl-l">
                                    <p class="pos-a tip">3-16字，可由中文,字母,数字及”_”组成</p>
                                    <input type="text" name="username" id="reg_username" value="{$login_info['username']}" class="input-text js-focus username" />
                                </div>
                            </div>
                            <div class="hr40"></div>
                            <div class="ov">
                                <label class="label fl-l singup-w70 margin-r-20">密码</label>
                                <div class="singup-line singup-item singup-w430 fl-l">
                                    <p class="pos-a tip">字符长度在6到16个字符之间</p>
                                    <input type="password" name="password" id="reg_password" class="input-text js-focus username" />
                                </div>
                            </div>
                            <div class="hr40"></div>
                            <div class="ov">
                                <label class="label fl-l singup-w70 margin-r-20">确认密码</label>
                                <div class="singup-line singup-item singup-w430 fl-l">
                                    <input type="password" id="reg_password_check" class="input-text username" name="password_check" />
                                </div>
                            </div>
                            <div class="hr40"></div>
                            <div class="ov">
                                <label class="label singup-w70 fl-l margin-r-20">邮箱</label>
                                <div class="singup-line singup-item singup-w430 fl-l">
                                    <input id="reg_email" type="text" class="input-text js-focus username" name="email" />
                                </div>
                            </div>
                            <div class="hr40"></div>
                            {if $mverification }
                            <div class="">
                                <label class="label singup-w70 fl-l margin-r-20">手机号码</label>
                                <div class="singup-line singup-item singup-w280 fl-l">
                                    <input id="reg_mobile_num" type="text" class="input-text js-focus username" name="mobile" />
                                </div>
                                <div class="fl-r singup-relative-mobileB20">
                                    <input type="button" id="mobile_send" value="发送验证码" disable="disable" class="fl-r submit disable button1 margin-r-60" />
                                </div>
                            </div>
                            <div class="hr40 singup-clear-mobile"></div>
                            <div class="ov" >
                                <label class="label singup-w70 fl-l margin-r-20">验证码</label>
                                <div class="singup-line singup-item singup-w430 fl-l">
                                    <input id="reg_mobile_code" type="text" class="input-text js-focus username" name="reg_mobile_code" />
                                </div>
                            </div>
                            {/if}
                            <div class="hr30"></div>
                            <div class="margin-l-70 ov">
                                <input id="iagree" type="checkbox" class="fl-l" style="margin-top: 2px;margin-right: 10px;" name="" id="" /><span class="fz12 fl-l">我同意</span> <a href="" class="fz12 cor06c fl-l">《本站免责声明》</a>
                            </div>
                            <div class="hr10"></div>
                            <div class="margin-l-70 submit-bar ov">
                                <input style="margin-left:0;" id="login_seccode" type="text" name="seccode" class="m-input-text fl-l i-gray" value="验证码">
                                <img id="seccode_img" src="{url('system/seccode/image')}" onclick="this.src='{url('system/seccode/image')}&id='+Math.random()*5;" class="fl-l" alt="" style="cursor: pointer;">
                                <a href="javascript:;" onclick="$('#seccode_img').click()" class="reload fl-l icon16x16"></a>
                            </div>
                            <div class="hr20"></div>
                            <div class="ov margin-l-70">
                                <input type="submit" value="注册" disable="disable" class="fl-l submit disable button1 margin-r-20" />
                                <span class="fz12" style="line-height:40px;">我已是会员 <a href="{url('member/index/login')}" class="fz12 cor06c">马上登录</a></span></div>
                            <div class="hr40"></div>
                        </form>
                    </div>
                    <div class="singup-form-right singup-w180 fl-l" style="margin-left:70px;">
                        <p class="fz16 title">使用第三方账号登录</p>
                        <div class="hr20"></div>
                        <div>
                            <a href="javascript:;" onclick="loginThirdParty(this,'qzone')" class="web-login qq">QQ账户</a>
                            <div class="hr30"></div>
                            <a href="javascript:;" onclick="loginThirdParty(this,'sina_weibo')" class="web-login sina">新浪微博</a>
                            <div class="hr30"></div>
                            <a href="javascript:;" onclick="loginThirdParty(this,'tencent_weibo')" class="web-login tqq">腾讯微博</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="hr100"></div>
    </div>
    <script type="text/javascript">
        $('#iagree').bind('click', function() {
            if ($('#iagree').is(':checked')) {
                $('#member_registerForm').find('input:submit').removeClass('disable').attr('alt', '').css('cursor','pointer').attr('disable', '');
            } else {
                $('#member_registerForm').find('input:submit').addClass('disable').attr('disable', 'disable').attr('alt', '必须先阅读并同意《本站免责声明》').css('cursor','default');
            }
        });
        $('form').submit(function(){
            if ($('form').find('p.warn').length > 0) {
                return false;
            }
            if (!$('#member_registerForm input[name=username]').val())
            {
                $('#member_registerForm input[name=username]').parent().find('p').addClass('hidden');
                $('#member_registerForm input[name=username]').parent().addClass('border-red').append('<p class="pos-a warn">用户名不能为空</p>');
                return false;
            } else if ($('#member_registerForm input[name=username]').val().length < 3) {
                $('#member_registerForm input[name=username]').parent().find('p').addClass('hidden');
                $('#member_registerForm input[name=username]').parent().addClass('border-red').append('<p class="pos-a warn">用户名不能小于3位</p>');
                return false;
            } else if ($('#member_registerForm input[name=username]').val().length > 16) {
                $('#member_registerForm input[name=username]').parent().find('p').addClass('hidden');
                $('#member_registerForm input[name=username]').parent().addClass('border-red').append('<p class="pos-a warn">用户名不能大于16位</p>');
                return false;
            }
            if (!$('#member_registerForm input[name=password]').val())
            {
                $('#member_registerForm input[name=password]').parent().find('p').addClass('hidden');
                $('#member_registerForm input[name=password]').parent().addClass('border-red').append('<p class="pos-a warn">密码不能为空</p>');
                return false;
            } else if ($('#member_registerForm input[name=password]').val().length < 6) {
                $('#member_registerForm input[name=password]').parent().find('p').addClass('hidden');
                $('#member_registerForm input[name=password]').parent().addClass('border-red').append('<p class="pos-a warn">密码不能小于6位</p>');
                return false;
            } else if ($('#member_registerForm input[name=password]').val().length > 16) {
                $('#member_registerForm input[name=password]').parent().find('p').addClass('hidden');
                $('#member_registerForm input[name=password]').parent().addClass('border-red').append('<p class="pos-a warn">密码不能大于16位</p>');
                return false;
            }
            if (!$('#member_registerForm input[name=password_check]').val())
            {
                $('#member_registerForm input[name=password_check]').parent().addClass('border-red').append('<p class="pos-a warn">确认密码不能为空</p>');
                return false;
            } else if($('#member_registerForm input[name=password]').val() != $('#member_registerForm input[name=password_check]').val()){
                $('#member_registerForm input[name=password_check]').parent().addClass('border-red').append('<p class="pos-a warn">与密码不一致</p>');
                return false;
            }
            if (!$('#member_registerForm input[name=email]').val())
            {
                $('#member_registerForm input[name=email]').parent().addClass('border-red').append('<p class="pos-a warn">Email不能为空</p>');
                return false;
            }
        });
        $('#member_registerForm input').focus(function(){
            $(this).parent().find('p.tip').addClass('hidden');
            $(this).parent().removeClass('border-red').find('p.warn').remove();
        });
        $('.submit').click(function(){
            if ($(this).attr('disable') == 'disable') {
                return false;
            }
        });

        var getRequest = true; // 是否请求验证码
        $('#mobile_send').click(function(){
            if ($(this).attr('disable') == 'disable' && !getRequest) {
                return false;
            }
            var mobileNum = $('#reg_mobile_num').val();
            if (!mobileNum) {
                $('#reg_mobile_num').parent().addClass('border-red').append('<p class="pos-a warn">手机号码不能为空</p>');
                return false;
            }
            /*
            if(!(/^1[34578]\d{9}$/.test(mobileNum))) {
                $(this).parent().addClass('border-red').append('<p class="pos-a warn">请输入正确的手机号码</p>');
                return false;
            }*/

            if (getRequest) {
                $.post('/?app=member&controller=index&action=sendmessage', {'mobilenumber' : parseInt($('#reg_mobile_num').val())}, function(json){
                    if (json.state) {
                        var waitTime = 60;
                        var timer = setInterval(function(){
                            $('#mobile_send').addClass('disable').attr('disable', 'disable');

                            $('#mobile_send').val(--waitTime +'重新获取');
                            if (waitTime == 0) {
                                clearInterval(timer);
                                $('#mobile_send').removeClass('disable').css('cursor','pointer').attr('disable', '').val('重新获取');
                                getRequest = true;
                            }
                        }, 1000);
                        getRequest = false;
                        alert(json.message);
                    } else {
                        alert(json.error);
                    }
                }, 'json')
            }
        });

        $(function(){
            if ($('#member_registerForm input[name=username]').val()) {
                $('#member_registerForm input[name=username]').prev().addClass('hidden');
            }
            if ($('#member_registerForm input[name=password]').val()) {
                $('#member_registerForm input[name=password]').prev().addClass('hidden');
            }
            $('#member_registerForm input').blur(function(){
                if ($(this).attr('name') == 'username') {
                    if (!$(this).val())
                    {
                        $(this).parent().find('p').addClass('hidden');
                        $(this).parent().addClass('border-red').append('<p class="pos-a warn">用户名不能为空</p>');
                    } else if ($(this).val().length < 3) {
                        $(this).parent().find('p').addClass('hidden');
                        $(this).parent().addClass('border-red').append('<p class="pos-a warn">用户名不能小于3位</p>');
                    } else if ($(this).val().length > 16) {
                        $(this).parent().find('p').addClass('hidden');
                        $(this).parent().addClass('border-red').append('<p class="pos-a warn">用户名不能大于16位</p>');
                    }
                }
                if ($(this).attr('name') == 'password') {
                    if (!$(this).val())
                    {
                        $(this).parent().find('p').addClass('hidden');
                        $(this).parent().addClass('border-red').append('<p class="pos-a warn">密码不能为空</p>');
                    } else if ($(this).val().length < 6) {
                        $(this).parent().find('p').addClass('hidden');
                        $(this).parent().addClass('border-red').append('<p class="pos-a warn">密码不能小于6位</p>');
                    } else if ($(this).val().length > 16) {
                        $(this).parent().find('p').addClass('hidden');
                        $(this).parent().addClass('border-red').append('<p class="pos-a warn">密码不能大于16位</p>');
                    }
                }
                if ($(this).attr('name') == 'password_check') {
                    if (!$(this).val())
                    {
                        $(this).parent().addClass('border-red').append('<p class="pos-a warn">确认密码不能为空</p>');
                    } else if ($(this).val() != $('#member_registerForm input[name=password]').val()) {
                        $(this).parent().addClass('border-red').append('<p class="pos-a warn">密码不一致</p>');
                    }
                }
                if ($(this).attr('name') == 'email') {
                    if (!$(this).val())
                    {
                        $(this).parent().addClass('border-red').append('<p class="pos-a warn">Email不能为空</p>');
                    }
                }
                if ($(this).attr('name') == 'mobile') {
                    if (!$(this).val())
                    {
                        $(this).parent().addClass('border-red').append('<p class="pos-a warn">手机号码不能为空</p>');
                        return false;
                    }
                    /*if(!(/^1[34578]\d{9}$/.test($(this).val()))) {
                        $(this).parent().addClass('border-red').append('<p class="pos-a warn">请输入正确的手机号码</p>');
                    }*/
                    $('#mobile_send').removeClass('disable').css('cursor','pointer').attr('disable', '');
                }
            });
        });
    </script>
    
    <!--#公共区块 网站底部#-->
    <!--#include virtual="/section/2.html"-->
</body>
</html>